use ut;

[test]
fn test_tsort_object_output_simple() {
    echo -e "a b\nb c" | new-file "/tmp/tsort_test_simple.txt";
    let result = (tsort --obj "/tmp/tsort_test_simple.txt");
    let sorted = result | slice-object sorted;
    let count = result | slice-object count;
    ut.assert_equals(count, 3, "Should have 3 nodes");
    rm "/tmp/tsort_test_simple.txt";
}

[test]
fn test_tsort_object_output_empty() {
    echo "" | new-file "/tmp/tsort_test_empty.txt";
    let result = (tsort --obj "/tmp/tsort_test_empty.txt");
    let count = result | slice-object count;
    ut.assert_equals(count, 0, "Empty graph should have 0 nodes");
    rm "/tmp/tsort_test_empty.txt";
}

[test]
fn test_tsort_object_output_complex() {
    echo -e "a b\na c\nb d\nc d" | new-file "/tmp/tsort_test_complex.txt";
    let result = (tsort --obj "/tmp/tsort_test_complex.txt");
    let sorted = result | slice-object sorted;
    let count = result | slice-object count;
    ut.assert_equals(count, 4, "Should have 4 nodes");
    rm "/tmp/tsort_test_complex.txt";
}

[test]
fn test_tsort_object_output_pretty() {
    echo -e "x y\ny z" | new-file "/tmp/tsort_test_pretty.txt";
    let result = (tsort --obj --pretty "/tmp/tsort_test_pretty.txt");
    let count = result | slice-object count;
    ut.assert_equals(count, 3, "Pretty output should work");
    rm "/tmp/tsort_test_pretty.txt";
}

[test]
fn test_tsort_object_output_single_node() {
    echo "a a" | new-file "/tmp/tsort_test_single.txt";
    let result = (tsort --obj "/tmp/tsort_test_single.txt");
    let count = result | slice-object count;
    ut.assert_equals(count, 1, "Self-loop should result in single node");
    rm "/tmp/tsort_test_single.txt";
}

[test]
fn test_tsort_object_output_linear() {
    echo -e "a b\nb c\nc d\nd e" | new-file "/tmp/tsort_test_linear.txt";
    let result = (tsort --obj "/tmp/tsort_test_linear.txt");
    let sorted = result | slice-object sorted;
    let count = result | slice-object count;
    ut.assert_equals(count, 5, "Linear graph should have 5 nodes");
    rm "/tmp/tsort_test_linear.txt";
}

[test]
fn test_tsort_object_output_field_filter() {
    echo "p q" | new-file "/tmp/tsort_test_filter.txt";
    let result = (tsort --obj "/tmp/tsort_test_filter.txt");
    let count_only = result | slice-object count;
    ut.assert_equals(count_only, 2, "Can extract count field using slice-object");
    rm "/tmp/tsort_test_filter.txt";
}

[test]
fn test_tsort_error_odd_tokens() {
    echo "a b c" | new-file "/tmp/tsort_test_odd.txt";
    rm "/tmp/tsort_test_odd.txt";
    ut.assert_true(true, "Test executed");
}

print ut.stats;
exit(ut.healthy);
