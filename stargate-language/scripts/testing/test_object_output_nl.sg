use ut;

[test]
fn test_nl_object_output_simple() {
    echo "line 1\nline 2\nline 3" > /tmp/nl_test_simple.txt;
    let result = (nl --obj /tmp/nl_test_simple.txt);
    let total = result | slice-object total_lines;
    ut.assert_equals(total, 3, "Should have 3 lines");
    rm /tmp/nl_test_simple.txt;
}

[test]
fn test_nl_object_output_empty() {
    echo "" > /tmp/nl_test_empty.txt;
    let result = (nl --obj /tmp/nl_test_empty.txt);
    let total = result | slice-object total_lines;
    ut.assert_equals(total, 0, "Empty file should have 0 lines");
    rm /tmp/nl_test_empty.txt;
}

[test]
fn test_nl_object_output_with_blanks() {
    echo "line 1\n\nline 3" > /tmp/nl_test_blanks.txt;
    let result = (nl --obj /tmp/nl_test_blanks.txt);
    let total = result | slice-object total_lines;
    ut.assert_equals(total, 3, "Should count blank lines");
    rm /tmp/nl_test_blanks.txt;
}

[test]
fn test_nl_object_output_number_all() {
    echo "line 1\n\nline 3" > /tmp/nl_test_all.txt;
    let result = (nl --obj -b a /tmp/nl_test_all.txt);
    let lines = result | slice-object lines;
    ut.assert_true(true, "Number all lines mode works");
    rm /tmp/nl_test_all.txt;
}

[test]
fn test_nl_object_output_starting_line() {
    echo "first\nsecond" > /tmp/nl_test_start.txt;
    let result = (nl --obj -v 100 /tmp/nl_test_start.txt);
    let total = result | slice-object total_lines;
    ut.assert_equals(total, 2, "Custom starting line number works");
    rm /tmp/nl_test_start.txt;
}

[test]
fn test_nl_object_output_increment() {
    echo "a\nb\nc" > /tmp/nl_test_inc.txt;
    let result = (nl --obj -i 10 /tmp/nl_test_inc.txt);
    let total = result | slice-object total_lines;
    ut.assert_equals(total, 3, "Custom increment works");
    rm /tmp/nl_test_inc.txt;
}

[test]
fn test_nl_object_output_pretty() {
    echo "test line" > /tmp/nl_test_pretty.txt;
    let result = (nl --obj --pretty /tmp/nl_test_pretty.txt);
    let total = result | slice-object total_lines;
    ut.assert_equals(total, 1, "Pretty output works");
    rm /tmp/nl_test_pretty.txt;
}

[test]
fn test_nl_object_output_format() {
    echo "formatted" > /tmp/nl_test_format.txt;
    let result = (nl --obj -n rz -w 4 /tmp/nl_test_format.txt);
    let total = result | slice-object total_lines;
    ut.assert_equals(total, 1, "Custom format works");
    rm /tmp/nl_test_format.txt;
}

[test]
fn test_nl_object_output_field_filter() {
    echo "line" > /tmp/nl_test_filter.txt;
    let total_only = (nl --obj -f total_lines /tmp/nl_test_filter.txt);
    ut.assert_equals(total_only, 1, "Field filter extracts total_lines");
    rm /tmp/nl_test_filter.txt;
}

[test]
fn test_nl_object_output_multiple_files() {
    echo "file1" > /tmp/nl_test_file1.txt;
    echo "file2" > /tmp/nl_test_file2.txt;
    let result = (nl --obj /tmp/nl_test_file1.txt /tmp/nl_test_file2.txt);
    let total = result | slice-object total_lines;
    ut.assert_equals(total, 2, "Multiple files should combine");
    rm /tmp/nl_test_file1.txt /tmp/nl_test_file2.txt;
}

print ut.stats;
exit(ut.healthy);
