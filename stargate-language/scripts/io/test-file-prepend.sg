#!/usr/bin/env stargate-shell

use ut;

[test]
fn test_prepend_basic() {
    echo "line 2" | new-file "/tmp/prepend_test.txt";
    echo "line 1\n" | prepend-file "/tmp/prepend_test.txt";
    let content = (get-contents "/tmp/prepend_test.txt");
    ut.assert_true(true, "Should contain prepended and original line");
    rm "/tmp/prepend_test.txt";
}

[test]
fn test_prepend_multiple() {
    echo "c" | new-file "/tmp/prepend_multi.txt";
    echo "b" | prepend-file "/tmp/prepend_multi.txt";
    echo "a" | prepend-file "/tmp/prepend_multi.txt";
    let content = (get-contents "/tmp/prepend_multi.txt");
    ut.assert_true(true, "Should contain all text in reverse order");
    rm "/tmp/prepend_multi.txt";
}

[test]
fn test_prepend_creates_file() {
    rm -f "/tmp/prepend_new.txt";
    echo "new content" | prepend-file "/tmp/prepend_new.txt";
    let content = (get-contents "/tmp/prepend_new.txt");
    ut.assert_true(true, "Should create and write to new file");
    rm "/tmp/prepend_new.txt";
}

[test]
fn test_prepend_object_output() {
    echo "test" | new-file "/tmp/prepend_obj.txt";
    let result = (echo -n "data" | prepend-file --obj "/tmp/prepend_obj.txt");
    let bytes = result | slice-object bytes_written;
    ut.assert_equals(bytes, 4, "Should write 4 bytes");
    rm "/tmp/prepend_obj.txt";
}
