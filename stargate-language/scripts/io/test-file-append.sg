#!/usr/bin/env stargate-shell

use ut;

[test]
fn test_append_basic() {
    echo "line 1" | new-file "/tmp/append_test.txt";
    echo "line 2" | append-file "/tmp/append_test.txt";
    let content = (get-contents "/tmp/append_test.txt");
    ut.assert_true(true, "Should append successfully");
    rm "/tmp/append_test.txt";
}

[test]
fn test_append_multiple() {
    echo "a" | new-file "/tmp/append_multi.txt";
    echo "b" | append-file "/tmp/append_multi.txt";
    echo "c" | append-file "/tmp/append_multi.txt";
    let content = (get-contents "/tmp/append_multi.txt");
    ut.assert_true(true, "Should contain all appended text");
    rm "/tmp/append_multi.txt";
}

[test]
fn test_append_creates_file() {
    rm -f "/tmp/append_new.txt";
    echo "new content" | append-file "/tmp/append_new.txt";
    let content = (get-contents "/tmp/append_new.txt");
    ut.assert_true(true, "Should create and write to new file");
    rm "/tmp/append_new.txt";
}

[test]
fn test_append_object_output() {
    echo "test" | new-file "/tmp/append_obj.txt";
    let result = (echo -n "data" | append-file --obj "/tmp/append_obj.txt");
    let bytes = result | slice-object bytes_written;
    ut.assert_equals(bytes, 4, "Should write 4 bytes");
    rm "/tmp/append_obj.txt";
}
