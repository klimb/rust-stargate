#!/usr/bin/env stargate-shell
use ut;

# Test: Built-in unit testing example
class Calculator {
    fn add(a, b) { return a + b; }
    fn multiply(a, b) { return a * b; }
}

[test]
fn test_addition() {
    let calc = new Calculator;
    ut.assert_equals(calc.add(2, 3), 5, "Addition should work");
    ut.assert_equals(calc.add(-1, 1), 0, "Should handle negatives");
}

[test]
fn test_multiplication() {
    let calc = new Calculator;
    ut.assert_equals(calc.multiply(3, 4), 12, "Multiplication should work");
}

# Test: Native lists with Python-style operations
[test]
fn test_list_operations() {
    let obj = (list-directory);
    let mixed = [obj, "text", 77, true];
    
    ut.assert_equals(mixed.length(), 4, "Mixed types work");
    ut.assert_equals(mixed[1], "text", "String element");
    ut.assert_equals(mixed[-1], true, "Last via negative index");
    
    mixed[2] = "replaced";
    ut.assert_equals(mixed[2], "replaced", "Type change works");
    
    mixed = mixed.append(3.14);
    ut.assert_equals(mixed.length(), 5, "Length after append");
}

# Test: Lists with various types
[test]
fn test_list_creation() {
    let nums = [1, 2, 3, 4, 5];
    let mixed = [1, "hello", true, 3.14];
    let nested = [[1, 2], [3, 4], [5, 6]];
    let empty = [];
    
    ut.assert_equals(nums[0], 1, "First element");
    ut.assert_equals(nums[-1], 5, "Last element via negative index");
    ut.assert_equals(mixed.length(), 4, "Mixed types list");
    ut.assert_equals(nested[1][0], 3, "Nested list access");
    ut.assert_equals(empty.length(), 0, "Empty list");
}

# Test: List manipulation
[test]
fn test_list_manipulation() {
    let nums = [1, 2, 3, 4, 5];
    nums[0] = 100;
    nums[-1] = 999;
    
    ut.assert_equals(nums[0], 100, "Index assignment");
    ut.assert_equals(nums[4], 999, "Negative index assignment");
    
    nums = nums.append(6);
    ut.assert_equals(nums.length(), 6, "After append");
    
    nums = nums.insert(0, 0);
    ut.assert_equals(nums[0], 0, "After insert at front");
    
    nums = nums.remove(2);
    ut.assert_equals(nums.length(), 6, "After remove");
    
    let size = nums.length();
    ut.assert_equals(size, 6, "Length method works");
    
    nums = nums.clear();
    ut.assert_equals(nums.length(), 0, "After clear");
}

# Test: OOP with classes and inheritance
class Animal {
    let name = "Unknown";
    let sound = "...";
}

class Dog extends Animal {
    let sound = "Woof";
    let breed = "Labrador";
}

[test]
fn test_inheritance() {
    let dog = new Dog;
    ut.assert_equals(dog.sound, "Woof", "Dog should override sound");
    ut.assert_equals(dog.name, "Unknown", "Dog should inherit name");
    ut.assert_equals(dog.breed, "Labrador", "Dog should have breed");
}

print ut.stats;
exit(ut.healthy);
